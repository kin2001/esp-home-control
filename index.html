<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Home Control via MQTT</title>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    button { width: 200px; height: 60px; margin: 10px; font-size: 20px; border: none; border-radius: 10px; }
    .on { background-color: #22c55e; color: white; }
    .off { background-color: #ef4444; color: white; }
  </style>
</head>
<body>
  <h1>MQTT Home Control</h1>
  <button id="lightBtn" class="off">Light is OFF</button><br>
  <button id="fanBtn" class="off">Fan is OFF</button>

  <script>
    const client = mqtt.connect("wss://ec8e8873f5b74b67a09925468064a435.s1.eu.hivemq.cloud:8884/mqtt", {
      username: "hivemq.webclient.1746500824550",
      password: "f7FcI;:0,D13jX>npTgU",
      clientId: "web_" + Math.random().toString(16).substr(2, 8),
      clean: true,
      connectTimeout: 4000,
      reconnectPeriod: 4000
    });

    client.on('connect', () => {
      console.log("Connected to HiveMQ!");
      client.subscribe("home/status/light");
      client.subscribe("home/status/fan");
    });

    client.on('message', (topic, message) => {
      const msg = message.toString();
      if (topic === "home/status/light") {
        const btn = document.getElementById("lightBtn");
        btn.textContent = "Light is " + msg;
        btn.className = msg === "ON" ? "on" : "off";
      } else if (topic === "home/status/fan") {
        const btn = document.getElementById("fanBtn");
        btn.textContent = "Fan is " + msg;
        btn.className = msg === "ON" ? "on" : "off";
      }
    });

    document.getElementById("lightBtn").addEventListener("click", () => {
      client.publish("home/control/light", "TOGGLE");
    });

    document.getElementById("fanBtn").addEventListener("click", () => {
      client.publish("home/control/fan", "TOGGLE");
    });
  </script>
</body>
</html>
